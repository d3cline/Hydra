{% extends "index.html" %}
{% load addcss %}
{% load tz %}
{% block head %}
<script src='/media/lib/moment.min.js'></script>
<script src="/media/bootstrap-datetimepicker.js"></script>
<link href="/media/bootstrap-datetimepicker.css" rel="stylesheet">
<script>
function copyToClipboardMsg(elem, msgElem) {
    var succeed = copyToClipboard(elem);
    var msg;
    if (!succeed) {
        msg = "Copy not supported or blocked.  Press Ctrl+c to copy."
    } else {
        msg = "Text copied to the clipboard."
    }
    if (typeof msgElem === "string") {
        msgElem = document.getElementById(msgElem);
    }
    msgElem.innerHTML = msg;
    setTimeout(function() {
        msgElem.innerHTML = "";
    }, 2000);
}

function copyToClipboard(elem) {
    // create hidden text element, if it doesn't already exist
    var targetId = "_hiddenCopyText_";
    var isInput = elem.tagName === "INPUT" || elem.tagName === "TEXTAREA";
    var origSelectionStart, origSelectionEnd;
    if (isInput) {
        // can just use the original source element for the selection and copy
        target = elem;
        origSelectionStart = elem.selectionStart;
        origSelectionEnd = elem.selectionEnd;
    } else {
        // must use a temporary form element for the selection and copy
        target = document.getElementById(targetId);
        if (!target) {
            var target = document.createElement("textarea");
            target.style.position = "absolute";
            target.style.left = "-9999px";
            target.style.top = "0";
            target.id = targetId;
            document.body.appendChild(target);
        }
        target.textContent = elem.textContent;
    }
    // select the content
    var currentFocus = document.activeElement;
    target.focus();
    target.setSelectionRange(0, target.value.length);
    // copy the selection
    var succeed;
    try {
        succeed = document.execCommand("copy");
    } catch (e) {
        succeed = false;
    }
    // restore original focus
    if (currentFocus && typeof currentFocus.focus === "function") {
        currentFocus.focus();
    }
    if (isInput) {
        // restore prior selection
        elem.setSelectionRange(origSelectionStart, origSelectionEnd);
    } else {
        // clear temporary content
        target.textContent = "";
    }
    return succeed;
}

</script>
<style>
.panel-2 {
color: #FFF;
background-color: #263238;
border-color: #000a12;
}
.panel-1 {
color: #FFF;
background-color: #4f5b62;
border-color: #000a12;
}
.dl-horizontal dt{
text-align: left;
margin-bottom: 1em;
width: auto;
padding-right: 1em;
}
.dl-horizontal dd{
margin-left: 0;
margin-bottom: 1em;
}
</style>
{% endblock %}
{% block body %}
<div class="container-fluid">
    <h1 class="page-header">Devices</h1>
    <div class="row">
        <div class="col-lg-3">
            <div class="btn-group" role="group" aria-label="Large button group">
                <a href="/device/add/" class="btn btn-outline btn-default" role="button">Add ü¶ë</a>
                <br>
                <br>
            </div>
            <span id="msg"></span>
        </div>
        <div class="col-lg-9">
            <div class="panel-group" id="accordion">

            </div>
            <div class="panel-group" id="accordion">
                {% for bot, form in bot_forms.items %}
                <div class="panel panel-{% if forloop.counter|divisibleby:2 %}1{% else %}2{% endif %}"
                     style="margin-left: 1em; margin-right: 1em;">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <div class="panel-title pull-left">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapse{{bot.id}}"
                                   aria-expanded="false" class="collapsed">{% if bot.name %}{{bot.name}}'s{% else %}{{bot.id}}{% endif %} Settings <i class="fa fa-gear"></i></a>
                            </div>
                            <div class="panel-title pull-right">
                                Token: <span id='token{{bot.id}}'>{{bot.token}}</span>
                                <button class="btn btn-default" id="copy{{bot.id}}">Copy</button>
                            </div>
                            <div class="clearfix"></div>
                        </h4>
                        <script>
document.getElementById("copy{{bot.id}}").addEventListener("click", function() {
copyToClipboardMsg(document.getElementById("token{{bot.id}}"), "msg");
});
                        </script>
                    </div>
                    <div id="collapse{{bot.id}}" class="panel-collapse collapse {% if forloop.first %} in {% endif %}"
                         aria-expanded="false">
                        <div class="panel-body">
                            <form class="uniForm" id="edit-profile" method="POST" enctype="multipart/form-data"
                                  action="/iotank/{{bot.id}}">
                                {% csrf_token %}
                                <fieldset class="inlineLabels">
                                    {{ form.non_field_errors }}


                                    <div class="form-group">

                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success dropdown-toggle"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Calibrate <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li>
                                                <p style="margin-left: 1em; margin-right: 1em;" class="text-info">This
                                                    This will launch the calibration page. Once calibration for a sensor has started it must be completed in order for ÔΩàÔΩôÔΩÑÔΩíÔΩÅ ü¶ë to function.</p>
                                                <a href="/device/calibrate/{{bot.id}}" class="btn btn-link" role="button">Confirm</a>
                                            </li>
                                        </ul>
                                    </div>
                                    </div>


                                    <div class="form-group">
                                        <label >IP: {{bot.ip}}</label>

                                    </div>
                                    <div class="form-group">
                                        <label >RSSI: {{bot.rssi}}</label>
                                    </div>

                                    <div class="form-group">
                                        {{ form.name.errors }}
                                        <label for="{{ form.name.id_for_label }}">Name</label>
                                        {{ form.name|addcss:"form-control" }}
                                    </div>

                                    <input class='btn btn-default' name="action" type="submit" value="Save"/>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-danger dropdown-toggle"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Delete <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li>
                                                <p style="margin-left: 1em; margin-right: 1em;" class="text-danger">This
                                                    will delete the token and all sensor data for this ÔΩàÔΩôÔΩÑÔΩíÔΩÅ ü¶ë. this action can not be
                                                    undone!</p>
                                                <a href="/device/delete/{{bot.id}}" class="btn btn-link" role="button">Confirm</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-warning dropdown-toggle"
                                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Regenerate token <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li>
                                                <p style="margin-left: 1em; margin-right: 1em;" class="text-warning">
                                                    This will regenerate the token for this ÔΩàÔΩôÔΩÑÔΩíÔΩÅ ü¶ë, causing the one in the
                                                    greenhouse to stop working until you re-flash. This action can not be undone!</p>
                                                <a href="/device/regen/{{bot.id}}" class="btn btn-link" role="button">Confirm</a>
                                            </li>
                                        </ul>
                                    </div>



                                    Created on {{bot.created_at}}
                                </fieldset>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endblock %}
